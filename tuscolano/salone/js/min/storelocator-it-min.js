!function($){function e(e){var t=e.coords.latitude+","+e.coords.longitude,o=new google.maps.LatLng(e.coords.latitude,e.coords.longitude);a(t,o)}function t(e){1===e.code?$("#status").html("<span>Non hai autorizzato la geolocalizzazione</span>").fadeOut(400,function(){$(this).children().remove()}):2===e.code?$("#status").html("<span>Posizione non disponibile</span>").fadeIn(400,function(){$(this).delay(2e3).fadeOut(400,function(){$(this).children().remove()})}):3===e.code?$("#status").html("<span>Timeout</span>").fadeIn(400,function(){$(this).delay(2e3).fadeOut(400,function(){$(this).children().remove()})}):$("#status").html("<span>"+e.message+"</span>").fadeIn(400,function(){$(this).delay(2e3).fadeOut(400,function(){$(this).children().remove()})})}function a(e,t,a){var s=t;a?(geocoder=new google.maps.Geocoder,geocoder.geocode({address:a},function(e,t){if(t==google.maps.GeocoderStatus.OK){if(i.width()>767)var r=$(window).height()-280;else var r=$(window).height()-180;$(".store-locator-content").css("height",r+"px"),$(".store-details").append().fadeOut(),$(".store-details").empty(),$(".store-locator-content").removeClass("left").addClass("center"),$(".storelocator-form").removeClass("right").addClass("center"),s=new google.maps.LatLng(e[0].geometry.location.lat(),e[0].geometry.location.lng());var l=e[0].geometry.location.lat()+","+e[0].geometry.location.lng(),n=a.split("+"),d="";d=n.length>1?18:10,o(l,s,d)}else $("#status").append("<span>Nessun centro nelle vicinanze</span>").fadeIn(400,function(){$(this).delay(2e3).fadeOut(400,function(){$(this).children().remove()}).insertBefore($("form #address"))})})):o(e,s)}function o(e,t,a){var o="";o=a?a:10;var r={zoom:o,center:t,mapTypeId:google.maps.MapTypeId.ROADMAP},l=new google.maps.Map(document.getElementById("map_canvas"),r),n=new google.maps.InfoWindow({content:""});s(l);var d="brands=836&coords="+e+"&distance=25";$.ajax({url:"http://yourbeautysite.it/api/stores/search.json",dataType:"json",data:d,async:!0,beforeSend:function(){$(".searchTitle").fadeOut(),$("form").fadeOut(200,function(){$(this).removeClass("center").addClass("right").fadeIn(400)}),$(".geolocalBtn").fadeOut(50),$(".overlayMap").fadeIn(150)},success:function(e){$(".show-grid").css("display","block"),$.each(e,function(e,t){var a=new google.maps.Marker({position:new google.maps.LatLng(t.latitudine,t.longitudine),map:l,title:t.nome,icon:templateUrl+"/public/images/marker.png"});if(google.maps.event.addListener(a,"click",function(){if(void 0!==t.orario){var e="";$.each(t.orario,function(t,a){e+=t+" Mattina: "+a.am+" - Pomeriggio: "+a.pm+" <br>"})}n.setContent('<span class="nameStore">'+t.nome+"</span><br>"+t.indirizzo+'<span class="dettaglio"><a class="pulsante" data-id="'+t.uid+'" data-lat="'+t.latitudine+'" data-lng="'+t.longitudine+'" data-nome="'+t.nome+'" data-indirizzo="'+t.indirizzo+'" data-tel="'+t.telefono+'"data-email="'+t.referente_email+'" data-orario="'+e+'" data-url="'+t.url+'" href="#">Dettaglio</a></span>'),n.setPosition(this.getPosition()),n.setMap(l)}),void 0!==t.orario){var o="";$.each(t.orario,function(e,t){o+=e+" Mattina: "+t.am+" - Pomeriggio: "+t.pm+" <br>"})}$("<div/>",{"class":"store-grid-item"}).appendTo(".store-grid").html('<span class="title">'+t.nome+'</span><span class="address">'+t.indirizzo+'</span><a href="tel:'+t.telefono+'" class="tel">'+t.telefono+'</a><a href="mailto:'+t.referente_email+'" class="email">'+t.referente_email+'</a><span class="dettaglio"><a class="pulsante" data-id="'+t.uid+'" data-lat="'+t.latitudine+'" data-lng="'+t.longitudine+'" data-nome="'+t.nome+'" data-indirizzo="'+t.indirizzo+'" data-tel="'+t.telefono+'"data-email="'+t.referente_email+'" data-orario="'+o+'" data-url="'+t.url+'" href="#">Dettaglio</a></span>')})},complete:function(){$(".overlayMap").fadeOut(150),$("body").delegate(".dettaglio .pulsante","click",function(){n.close(),$(".show-map").fadeOut(),$(".show-grid").fadeOut(),$(".store-grid").hide(),$("#map_canvas").fadeIn(10),$(".page-template-store-locator").css({backgroundImage:"none",backgroundColor:"#000"});var e=$(this).data("id"),t=$(this).data("orario"),a=$(this).data("nome"),o=$(this).data("indirizzo"),s=$(this).data("tel"),r=$(this).data("email"),d=$(this).data("url"),c=$(this).data("lat"),p=$(this).data("lng");$(".store-locator-content").removeClass("center").addClass("left"),$("form").addClass("details"),google.maps.event.trigger(l,"resize"),l.setZoom(17),l.setCenter({lat:c,lng:p}),$(".store-details").empty(),$(".store-details").append($("<div />").attr("class","store-name").text(a)).append($("<div />").attr("class","store-address").text(o)),"undefined"!==s&&$(".store-details").append($("<a />").attr("href","tel:"+s).attr("class","store-tel").text("tel: "+s)),null!=r&&$(".store-details").append($("<a />").attr("class","store-email").attr("href","mailto:"+r).text(r)),"undefined"!==t&&$(".store-details").append($("<div />").attr("class","store-orario").html('<span class="store-orario-title">Orario apertura:</span>'+t)),"undefined"!==d&&$(".store-details").append($("<div />").attr("class","span12 store-url").html('<a class="pulsante" href="'+d+'">visit the site</a>')),i.width()<768?$(".store-details").insertAfter($("#storelocator-form")).fadeIn():$(".store-details").append().fadeIn()}),$(".show-grid").bind("click",function(){$(".show-grid").css("display","none"),$(".show-map").css("display","block"),$(".page-template-store-locator #masthead, #storelocator-form").css({position:"fixed","z-index":"9999"}),$("#map_canvas").fadeOut(),$(".store-grid").fadeIn(),$(".store-locator-content").removeClass("map").addClass("grid")}),$(".show-map").bind("click",function(){$(".show-grid").css("display","block"),$(".show-map").css("display","none"),$(".page-template-store-locator #masthead, #storelocator-form").css({position:"static","z-index":"0"}),$("#map_canvas").fadeIn(),$(".store-grid").fadeOut(),$(".store-locator-content").removeClass("grid").addClass("map"),lastCenter=l.getCenter(),google.maps.event.trigger(l,"resize"),l.setCenter(lastCenter)}),$(".backMap").bind("click",function(){$(".store-locator-content").hasClass("grid")?($("#map_canvas").hide(),$(".store-grid").show(),$(".show-map").show()):$(".store-locator-content").hasClass("map")&&($("#map_canvas").show(),$(".store-grid").hide(),$(".show-grid").show()),$(".store-details").empty(),$(".store-locator-content").removeClass("left").addClass("center"),$(".storelocator-form").removeClass("right").addClass("center"),$(".store-details").append().fadeOut(),$(".page-template-store-locator").css({backgroundImage:"url("+templateUrl+"/public/images/bg-store-locator.jpg)"}),google.maps.event.trigger(l,"resize"),l.setZoom(10)})},error:function(){$("#status").html("<span>error</span>").fadeOut(400,function(){$(this).children().remove()})}})}function s(e){e.set("styles",[{featureType:"road.highway",elementType:"geometry.fill",stylers:[{color:"#81764e"}]},{featureType:"landscape.natural",elementType:"geometry.fill",stylers:[{lightness:68},{gamma:.45},{color:"#4af3ea"}]},{featureType:"water",elementType:"geometry.fill",stylers:[{color:"#808080"}]},{featureType:"poi.park",stylers:[{color:"#d5d3cc"},{lightness:15}]},{featureType:"poi.medical",elementType:"geometry.fill",stylers:[{color:"#dcdcdc"}]},{featureType:"poi.government",elementType:"geometry.fill",stylers:[{color:"#cecece"}]},{featureType:"road",elementType:"geometry.fill",stylers:[{color:"#81764e"},{weight:.3}]},{featureType:"road.arterial",elementType:"geometry.stroke",stylers:[{color:"#81764e"}]},{featureType:"poi.school",elementType:"geometry.fill",stylers:[{color:"#8a8686"}]},{featureType:"landscape.natural",stylers:[{color:"#ffffff"}]},{featureType:"poi",elementType:"geometry.stroke",stylers:[{color:"#dcdcdc"},{lightness:37}]},{featureType:"landscape.natural",stylers:[{color:"#fafafa"}]},{},{},{featureType:"road.arterial",stylers:[{color:"#81764e"},{weight:.5}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#81764e"},{weight:.7}]},{featureType:"road",elementType:"geometry.stroke",stylers:[{color:"#81764e"},{weight:.1},{visibility:"simplified"}]},{featureType:"road",elementType:"labels",stylers:[{color:"#f9f9fa"},{visibility:"off"}]},{featureType:"poi",elementType:"geometry.fill",stylers:[{color:"#c6c6c6"}]},{featureType:"transit.line",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"geometry.fill",stylers:[{color:"#dddddd"}]},{featureType:"administrative",stylers:[{visibility:"on"}]},{featureType:"road",elementType:"geometry.fill",stylers:[{color:"#81764e"},{visibility:"simplified"},{weight:.5}]},{featureType:"landscape",stylers:[{color:"#eff0f0"}]}])}var r=$("body"),i=$(window);$("#geolocalBtn").on("click",function(){if(i.width()>767)var o=$(window).height()-280;else var o=$(window).height()-180;$(".store-grid").empty(),$(".store-locator-content").css("height",o+"px"),navigator.geolocation.getCurrentPosition(e,t,{enableHighAccuracy:!0,timeout:1e4,maximumAge:0}),a(data_input,latlng)}),$("#storelocator-form").submit(function(e){e.preventDefault(),$(".store-grid").empty();var t=$(this).serialize();if("address="!==t){var o="brands=836&coords=";a(o,null,t)}else $("#status").append("<span>Inserisci la citt√†</span>").fadeIn(400,function(){$(this).delay(2e3).fadeOut(400,function(){$(this).children().remove()})})})}(jQuery);